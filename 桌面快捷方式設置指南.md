# 🖥️ Raspberry Pi 桌面快捷方式設置指南

## 📋 **概覽**

取消自動啟動，改為桌面手動啟動模式，讓你完全控制甦醒地圖的運行時機。

---

## 🚀 **快速設置 (一鍵安裝)**

### **步驟 1: 傳輸設置腳本到樹莓派**

在你的電腦上執行：
```bash
# 傳輸設置腳本
scp create-desktop-shortcut.sh future@raspberrypi:~/
```

### **步驟 2: SSH 連接並執行設置**

```bash
# 連接到樹莓派
ssh future@raspberrypi

# 執行設置腳本
cd ~
chmod +x create-desktop-shortcut.sh
./create-desktop-shortcut.sh
```

設置腳本會自動：
- ✅ 創建桌面快捷方式圖標
- ✅ 創建啟動腳本
- ✅ 創建停止腳本  
- ✅ 提示是否禁用自動啟動服務

---

## 📁 **設置完成後的文件結構**

```
🏠 /home/future/
├── 🖥️ Desktop/
│   └── 甦醒地圖.desktop                    # 桌面快捷方式圖標
└── 📂 pi/subjective-clock/raspberrypi-dsi/
    ├── 🚀 start-wakeup-map.sh              # 啟動腳本
    └── 🛑 stop-wakeup-map.sh               # 停止腳本
```

---

## 🎯 **使用方式**

### **啟動甦醒地圖**
1. **雙擊桌面圖標**: 在桌面上找到 "甦醒地圖" 圖標，雙擊啟動
2. **終端視窗會開啟**: 顯示程式運行狀態和日誌
3. **等待初始化完成**: 看到啟動成功訊息後即可使用

### **停止甦醒地圖**  
有三種方式：

**方法一: 終端快捷鍵 (推薦)**
```bash
# 在終端視窗中按
Ctrl + C
```

**方法二: 關閉終端視窗**
- 直接點擊終端視窗的 X 按鈕

**方法三: 執行停止腳本**
```bash
# 在新的終端中執行
~/pi/subjective-clock/raspberrypi-dsi/stop-wakeup-map.sh
```

---

## 🔧 **禁用自動啟動 (重要)**

### **檢查當前自動啟動狀態**
```bash
# 檢查服務狀態
sudo systemctl status wakeupclock

# 檢查是否啟用自動啟動
sudo systemctl is-enabled wakeupclock
```

### **禁用自動啟動**
```bash
# 停止服務
sudo systemctl stop wakeupclock

# 禁用開機自動啟動
sudo systemctl disable wakeupclock

# 確認已禁用
sudo systemctl is-enabled wakeupclock
# 應該顯示: disabled
```

### **如果需要重新啟用自動啟動**
```bash
# 重新啟用
sudo systemctl enable wakeupclock
sudo systemctl start wakeupclock
```

---

## 🖥️ **桌面快捷方式詳細配置**

### **桌面文件內容** (`~/Desktop/甦醒地圖.desktop`)
```ini
[Desktop Entry]
Version=1.0
Type=Application
Name=甦醒地圖
Name[en]=WakeUp Map
Comment=啟動甦醒地圖主控程式
Comment[en]=Start WakeUp Map Main Controller
Exec=/home/future/pi/subjective-clock/raspberrypi-dsi/start-wakeup-map.sh
Icon=/home/future/pi/subjective-clock/icon-192x192.png
Terminal=true
StartupNotify=true
Categories=Utility;
Keywords=wakeup;map;raspberry;pi;
```

### **自定義圖標** (可選)
```bash
# 如果你有自己的圖標文件，可以替換
cp 你的圖標.png ~/pi/subjective-clock/icon-192x192.png

# 或者修改桌面文件中的 Icon 路徑
nano ~/Desktop/甦醒地圖.desktop
```

---

## 🚀 **啟動腳本功能** (`start-wakeup-map.sh`)

### **自動檢測主控制程式**
腳本會按優先順序檢測：
1. `main_controller.py` (模組化版本)
2. `main_web_dsi.py` (傳統版本)

### **功能特色**
- 🖥️ **彩色終端輸出**: 清晰的狀態顯示
- 📝 **日誌記錄**: 自動保存到 `wakeup-map.log`
- 🛡️ **錯誤處理**: 智能檢測和錯誤提示
- 🔄 **優雅關閉**: Ctrl+C 安全停止程式

### **終端輸出示例**
```bash
🌅 甦醒地圖啟動程式
=================

📁 工作目錄: /home/future/pi/subjective-clock/raspberrypi-dsi
📝 日誌文件: /home/future/pi/subjective-clock/wakeup-map.log

🚀 使用模組化主控制程式: main_controller.py

按 Ctrl+C 可隨時停止程式
===================

🌅 正在啟動甦醒地圖主控制程式...
[2025-01-08 10:30:15] 🚀 甦醒地圖控制器啟動中...
[2025-01-08 10:30:16] ✅ 所有模組初始化完成
[2025-01-08 10:30:17] 🔘 等待實體按鈕觸發...
```

---

## 🛠️ **手動設置 (進階用戶)**

如果你想手動創建而不使用自動腳本：

### **1. 創建桌面快捷方式**
```bash
# 創建桌面目錄 (如果不存在)
mkdir -p ~/Desktop

# 創建桌面快捷方式文件
nano ~/Desktop/甦醒地圖.desktop
```

貼上桌面文件內容，然後：
```bash
# 設置執行權限
chmod +x ~/Desktop/甦醒地圖.desktop
```

### **2. 創建啟動腳本**
```bash
# 創建啟動腳本
nano ~/pi/subjective-clock/raspberrypi-dsi/start-wakeup-map.sh
```

貼上啟動腳本內容，然後：
```bash
# 設置執行權限
chmod +x ~/pi/subjective-clock/raspberrypi-dsi/start-wakeup-map.sh
```

---

## 🧪 **測試和驗證**

### **測試桌面快捷方式**
1. 在桌面上找到 "甦醒地圖" 圖標
2. 雙擊圖標
3. 應該會開啟終端視窗並顯示啟動訊息
4. 按 Ctrl+C 停止程式

### **測試手動啟動**
```bash
# 直接執行啟動腳本
~/pi/subjective-clock/raspberrypi-dsi/start-wakeup-map.sh
```

### **檢查進程狀態**
```bash
# 檢查是否有甦醒地圖進程在運行
pgrep -f "main_web_dsi.py\|main_controller.py"

# 查看詳細進程信息
ps aux | grep -E "main_web_dsi.py|main_controller.py"
```

---

## 🚨 **故障排除**

### **問題 1: 桌面圖標無法點擊**
```bash
# 檢查文件權限
ls -la ~/Desktop/甦醒地圖.desktop
chmod +x ~/Desktop/甦醒地圖.desktop

# 檢查文件內容格式
cat ~/Desktop/甦醒地圖.desktop
```

### **問題 2: 啟動腳本找不到文件**
```bash
# 檢查路徑是否正確
ls -la ~/pi/subjective-clock/raspberrypi-dsi/
ls -la ~/pi/subjective-clock/raspberrypi-dsi/main_controller.py
ls -la ~/pi/subjective-clock/raspberrypi-dsi/main_web_dsi.py
```

### **問題 3: 權限問題**
```bash
# 重新設置所有權限
chmod +x ~/Desktop/甦醒地圖.desktop
chmod +x ~/pi/subjective-clock/raspberrypi-dsi/start-wakeup-map.sh
chmod +x ~/pi/subjective-clock/raspberrypi-dsi/stop-wakeup-map.sh
```

### **問題 4: 程式無法停止**
```bash
# 強制停止所有相關進程
sudo pkill -f "main_web_dsi.py"
sudo pkill -f "main_controller.py"

# 或者使用停止腳本
~/pi/subjective-clock/raspberrypi-dsi/stop-wakeup-map.sh
```

---

## 📊 **優勢對比**

| 功能 | 自動啟動模式 | 桌面快捷方式模式 |
|------|-------------|------------------|
| **控制性** | 低 (開機即啟動) | 高 (手動控制) |
| **系統資源** | 持續占用 | 按需使用 |
| **調試便利性** | 低 (背景運行) | 高 (終端可見) |
| **意外關閉風險** | 高 (難以停止) | 低 (易於停止) |
| **開發友好性** | 低 | 高 |

---

## 🎉 **完成檢查清單**

- [ ] ✅ 桌面上有 "甦醒地圖" 圖標
- [ ] ✅ 雙擊圖標可以啟動程式  
- [ ] ✅ 終端顯示彩色啟動訊息
- [ ] ✅ Ctrl+C 可以正常停止程式
- [ ] ✅ 自動啟動服務已禁用
- [ ] ✅ 重開機後程式不會自動啟動
- [ ] ✅ GPIO 按鈕功能正常
- [ ] ✅ 日誌文件正確生成

**🎯 現在你可以完全控制甦醒地圖的啟動時機，同時享受清晰的終端輸出和便捷的手動控制！** 🚀✨