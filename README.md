# 甦醒地圖 Wake Up Map

一個基於時間和緯度偏好的全球城市探索系統，讓你每次按下按鈕都能在地球上的不同角落「甦醒」。

## 🌍 專案概述

甦醒地圖是一個創新的地理探索應用，結合了時間感知、地理定位和智能推薦算法，為用戶提供個性化的全球城市體驗。每次互動都會根據當前時間計算出獨特的緯度偏好，並找到世界上符合條件的城市。

### 核心理念
- **時間驅動的地理探索**：不同時間對應不同緯度偏好
- **智能避重機制**：減少重複訪問相同城市
- **多語言體驗**：提供當地語言的問候和故事
- **跨平台同步**：網頁版與樹莓派實體裝置無縫整合

## 🎯 網頁版設計邏輯

### 1. 時間基礎的緯度計算系統

#### 標準時間段 (00:00-07:49, 08:11-23:59)
```javascript
// 基於分鐘數的線性映射
targetLatitude = 70 - (minutes * 140 / 59)
```

**設計原理：**
- **0分鐘** → 北緯70度（極地地區）
- **30分鐘** → 赤道0度（熱帶地區）  
- **59分鐘** → 南緯70度（南極地區）
- **避免極地問題**：限制在±70度範圍內，確保有人居住的地區

#### 特例時間段 (07:50-08:10)
```javascript
// 使用用戶當地位置
if (時間 === 7:50-8:10) {
    使用地理位置API獲取用戶當前位置
}
```

**設計考量：**
- **晨醒概念**：早晨時段應該在熟悉的環境甦醒
- **地理定位**：自動獲取用戶實際位置
- **優雅降級**：定位失敗時回到赤道附近

### 2. 智能城市選擇算法

#### 避重機制
```javascript
// 城市訪問統計追蹤
cityVisitStats = {
    "New York": 3,
    "Tokyo": 1,
    "Paris": 2
}

// 降低重複城市的選擇權重
weightedScore = baseScore * (1 / (visitCount + 1))
```

#### 多重篩選條件
1. **UTC時區匹配**：確保當地時間符合預期
2. **緯度偏好匹配**：根據時間計算的緯度範圍
3. **使用者歷史**：避免過度重複的城市
4. **資料品質**：優先選擇有完整翻譯的城市

### 3. 使用者體驗流程

#### 完整互動步驟
```
1. 用戶設定 → 輸入顯示名稱和組別
2. 按鈕觸發 → 計算當前時間的緯度偏好  
3. API調用 → 尋找符合條件的全球城市
4. 結果顯示 → 展示城市資訊和地圖位置
5. 語言體驗 → 播放當地語言問候
6. 故事生成 → 創建個性化旅行故事
7. 記錄保存 → 儲存到個人歷史和全域記錄
8. 圖片生成 → 創建城市特色早餐圖片
```

## 🛠 技術架構

### 前端技術棧
- **HTML5 + CSS3**：響應式設計界面
- **Vanilla JavaScript**：純JS實現，無框架依賴
- **Leaflet.js**：互動式地圖顯示
- **Firebase SDK**：即時資料庫整合
- **Web APIs**：地理定位、語音合成

### 後端服務 (Vercel Serverless)
```
/api/find-city-geonames/    # GeoNames API 城市搜尋
/api/translate-location/    # 多語言地名翻譯  
/api/generateStory/         # AI 故事生成
/api/generateImage/         # AI 圖片生成
/api/save-record/          # 記錄同步 (樹莓派專用)
```

### 資料庫設計 (Firebase Firestore)
```
userHistory/              # 使用者個人歷史
├── 文件ID
    ├── userDisplayName   # 顯示名稱
    ├── city/country      # 城市國家 (中英文)
    ├── coordinates       # GPS座標
    ├── timezone          # 時區資訊
    ├── recordedAt        # 記錄時間
    └── deviceType        # 裝置類型

globalDailyRecords/       # 全域每日記錄
├── 文件ID  
    ├── 同上結構
    └── 用於眾人地圖顯示
```

## 🎮 使用者功能詳解

### 1. 個人化設定
- **顯示名稱**：用於記錄識別和社群分享
- **組別設定**：支援團體使用和統計分析
- **資料持久化**：使用 localStorage 保存設定

### 2. 甦醒體驗
- **時間感知**：每個時間點都有獨特的探索體驗
- **地理多樣性**：覆蓋全球 195+ 個國家和地區
- **文化沉浸**：當地語言問候 + 文化背景故事

### 3. 記錄系統
- **個人軌跡**：查看自己的甦醒歷史
- **眾人地圖**：探索其他人的甦醒足跡
- **統計分析**：城市訪問頻率和偏好分析

### 4. 智能避重
- **訪問統計**：追蹤每個城市的訪問次數
- **權重調整**：降低重複城市的選中機率
- **新鮮感保持**：鼓勵探索更多不同城市

## 🤖 樹莓派整合

### 實體裝置同步
- **使用者設定**：自動配置為 "future" 使用者
- **按鈕觸發**：物理按鈕觸發相同的甦醒邏輯
- **記錄同步**：透過 `/api/save-record` 同步到網站
- **音頻體驗**：本地播放多語言問候

### 裝置類型支援
- `web_browser`：網頁版使用者
- `raspberry_pi`：LCD 版樹莓派
- `raspberry_pi_dsi`：DSI 螢幕版樹莓派

## 🔧 API 端點詳解

### 城市搜尋 API
```javascript
POST /api/find-city-geonames
{
    "targetUTCOffset": 8.0,
    "targetLatitude": 25.0,
    "timeMinutes": 30,
    "userCityVisitStats": {"Tokyo": 2},
    "useLocalPosition": false
}
```

### 記錄同步 API  
```javascript
POST /api/save-record
{
    "userDisplayName": "future",
    "city": "Tokyo",
    "country": "Japan",
    "latitude": 35.6762,
    "longitude": 139.6503,
    "deviceType": "raspberry_pi"
}
```

## 🌐 多語言支援

### 支援語言列表
中文、英文、日文、韓文、法文、德文、西班牙文、意大利文、俄文、阿拉伯文、泰文、越南文、印尼文、馬來文、土耳其文等 15+ 種語言

### 語言選擇邏輯
1. **國家代碼映射**：根據城市所在國家自動選擇
2. **備用方案**：未知國家使用英文
3. **發音優化**：使用 Web Speech API 進行語音合成

## 📱 響應式設計

### 裝置適配
- **桌面版**：完整功能體驗，大螢幕地圖
- **平板版**：適中的界面佈局和互動元素  
- **手機版**：簡化界面，觸控優化

### 效能優化
- **延遲載入**：地圖和圖片按需載入
- **錯誤處理**：網路異常時的優雅降級
- **快取機制**：減少重複的 API 呼叫

## 🔒 隱私與安全

### 資料保護
- **匿名使用**：可選擇匿名模式探索
- **本地儲存**：敏感設定存於本地端
- **HTTPS 加密**：所有 API 通信使用 HTTPS

### 地理隱私
- **位置控制**：用戶主動同意才使用定位
- **特例時段**：僅在 7:50-8:10 使用真實位置
- **位置混淆**：不存儲精確的用戶位置

## 🚀 部署與維護

### Vercel 部署
```bash
# 自動部署
git push origin main

# 環境變數配置
FIREBASE_API_KEY=your_api_key
GEONAMES_USERNAME=your_username
OPENAI_API_KEY=your_openai_key
```

### 監控與日誌
- **API 錯誤追蹤**：自動記錄 API 失敗
- **使用量統計**：追蹤功能使用頻率
- **效能監控**：載入時間和響應速度

## 📈 未來發展

### 功能擴展
- **社群功能**：使用者之間的互動和分享
- **AI 優化**：更智能的城市推薦算法
- **AR/VR 體驗**：沉浸式的城市探索

### 技術升級
- **PWA 支援**：離線使用和原生體驗
- **即時通信**：WebSocket 實現即時互動
- **機器學習**：個性化推薦優化

---

## 🏗 開發指南

### 本地開發
```bash
# 安裝依賴
npm install

# 啟動開發伺服器  
vercel dev

# 本地測試
open http://localhost:3000
```

### 程式碼結構
```
├── index.html          # 主頁面
├── script.js          # 核心邏輯
├── style.css          # 樣式表
├── api/               # 後端 API
│   ├── find-city-geonames/
│   ├── translate-location/
│   ├── generateStory/
│   ├── generateImage/
│   └── save-record/
└── raspberrypi/       # 樹莓派程式碼
    ├── main.py
    ├── api_client.py
    └── ...
```

這個甦醒地圖專案融合了地理學、時間哲學和人工智能，為使用者創造獨特的全球探索體驗。每一次的「甦醒」都是一次新的發現之旅！ 🌍✨