<div id="matchResult" style="margin-top:2rem; font-size:1.2rem;"></div>

<script>
fetch('cities_with_timezones.json')
  .then(response => response.json())
  .then(cities => {
    const now = new Date();
    const localOffsetMin = -now.getTimezoneOffset(); // åˆ†é˜
    const nowMinutes = now.getHours() * 60 + now.getMinutes();

    const offsetFrom8AM = nowMinutes - (8 * 60); // å·®è·åˆ†é˜æ•¸
    const targetOffset = (localOffsetMin - offsetFrom8AM) / 60; // æœŸæœ›çš„ offset å°æ™‚

    // ğŸ”¢ å–å¾—ç•¶å‰åˆ†é˜ï¼Œå°æ‡‰ 0~59 â ç·¯åº¦æ’åºç™¾åˆ†æ¯”
    const minutePart = now.getMinutes(); // 0â€“59
    const latIndexRatio = minutePart / 59; // â†’ 0.00~1.00

    // ğŸ¯ é¸å‡ºæ‰€æœ‰ç¬¦åˆ offset æ¢ä»¶çš„åŸå¸‚ï¼ˆÂ±0.5 å°æ™‚ï¼‰
    const filtered = cities.filter(c => Math.abs(c.offset - targetOffset) < 0.5 && c.lat !== undefined);

    if (filtered.length === 0) {
      document.getElementById("matchResult").innerHTML = `ğŸŒ Could not find a matching city.`;
      return;
    }

    // ğŸŒ ä¾ç…§ç·¯åº¦æ’åºï¼ˆåŒ— â†’ å—ï¼‰
    const sorted = filtered.sort((a, b) => b.lat - a.lat);

    // ğŸ¯ æ ¹æ“š minute è½åœ¨ç·¯åº¦æ’åºä½ç½®ä¸­
    const selected = sorted[Math.floor(latIndexRatio * (sorted.length - 1))];

    document.getElementById("matchResult").innerHTML =
      `â˜€ï¸ Today, you started your day just like someone in <b>${selected.country}</b>, <b>${selected.city}</b>.`;
  })
  .catch(err => {
    console.error("âŒ Failed to load city data:", err);
    document.getElementById("matchResult").innerText = "Data load failed.";
  });
</script>
