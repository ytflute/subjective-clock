<div id="matchResult" style="margin-top:2rem; font-size:1.2rem;"></div>

<script>
fetch('cities_with_timezones.json')
  .then(response => response.json())
  .then(cities => {
    const now = new Date();
    const localOffsetMin = -now.getTimezoneOffset(); // 分鐘
    const nowMinutes = now.getHours() * 60 + now.getMinutes();

    const offsetFrom8AM = nowMinutes - (8 * 60); // 差距分鐘數
    const targetOffset = (localOffsetMin - offsetFrom8AM) / 60; // 期望的 offset 小時

    // 🔢 取得當前分鐘，對應 0~59 ➝ 緯度排序百分比
    const minutePart = now.getMinutes(); // 0–59
    const latIndexRatio = minutePart / 59; // → 0.00~1.00

    // 🎯 選出所有符合 offset 條件的城市（±0.5 小時）
    const filtered = cities.filter(c => Math.abs(c.offset - targetOffset) < 0.5 && c.lat !== undefined);

    if (filtered.length === 0) {
      document.getElementById("matchResult").innerHTML = `🌍 Could not find a matching city.`;
      return;
    }

    // 🌎 依照緯度排序（北 → 南）
    const sorted = filtered.sort((a, b) => b.lat - a.lat);

    // 🎯 根據 minute 落在緯度排序位置中
    const selected = sorted[Math.floor(latIndexRatio * (sorted.length - 1))];

    document.getElementById("matchResult").innerHTML =
      `☀️ Today, you started your day just like someone in <b>${selected.country}</b>, <b>${selected.city}</b>.`;
  })
  .catch(err => {
    console.error("❌ Failed to load city data:", err);
    document.getElementById("matchResult").innerText = "Data load failed.";
  });
</script>
