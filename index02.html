<script>
fetch('cities_with_timezones.json')
  .then(response => response.json())
  .then(cities => {
    const now = new Date();
    const localOffsetMin = -now.getTimezoneOffset(); // Êú¨Âú∞ offsetÔºåÂñÆ‰ΩçÔºöÂàÜÈêò
    const nowMinutes = now.getHours() * 60 + now.getMinutes();

    const offsetFrom8AM = nowMinutes - (8 * 60); // Ëàá 08:00 Áõ∏Â∑ÆÂπæÂàÜÈêò
    const targetOffset = (localOffsetMin - offsetFrom8AM) / 60; // Êé®ÁÆóÂ∞çÈΩä 08:00 ÊâÄÈúÄÁöÑ offsetÔºàÂ∞èÊôÇÔºâ

    const minutePart = now.getMinutes(); // 0‚Äì59
    const latIndexRatio = minutePart / 59; // Â∞çÊáâÁ∑ØÂ∫¶ÊéíÂ∫èÁöÑ‰ΩçÁΩÆÔºàÂåó‚ÜíÂçóÔºâ

    // ÈÅéÊøæÂá∫ offset Êé•Ëøë target ÁöÑÂüéÂ∏ÇÔºå‰∏¶‰∏îÂÖ∑ÊúâÊúâÊïàÁ∑ØÂ∫¶
    const filtered = cities.filter(c =>
      Math.abs(Number(c.offset) - targetOffset) < 0.5 &&
      typeof c.latitude === "number"
    );

    if (filtered.length === 0) {
      document.getElementById("matchResult").innerHTML = `üåç Could not find a matching city.`;
      return;
    }

    // Ê†πÊìöÁ∑ØÂ∫¶Áî±Âåó‚ÜíÂçóÊéíÂ∫è
    const sorted = filtered.sort((a, b) => b.latitude - a.latitude);
    const selected = sorted[Math.floor(latIndexRatio * (sorted.length - 1))];

    document.getElementById("matchResult").innerHTML =
      `‚òÄÔ∏è Today, you started your day just like someone in <b>${selected.country}</b>, <b>${selected.city}</b>.`;
  })
  .catch(err => {
    console.error("‚ùå Failed to load city data:", err);
    document.getElementById("matchResult").innerText = "Data load failed.";
  });
</script>
