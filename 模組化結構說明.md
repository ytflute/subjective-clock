# ğŸ—ï¸ Pi.html æ¨¡çµ„åŒ–é‡æ§‹èªªæ˜

## ğŸ“‹ **é‡æ§‹æ¦‚è¦½**

å°‡åŸæœ¬å–®ä¸€çš„ `pi.html` æª”æ¡ˆé‡æ§‹ç‚º**çµ„ä»¶åŒ–æ¶æ§‹**ï¼Œæå‡ç¶­è­·æ€§å’Œå¯è®€æ€§ã€‚

### **ğŸ¯ é‡æ§‹ç›®æ¨™**
- âœ… åˆ†é›¢ä¸‰å€‹ä¸»è¦é é¢ç‚ºç¨ç«‹çµ„ä»¶
- âœ… æ­é… `pi-script-refactored.js` ä½¿ç”¨
- âœ… æå‡ä»£ç¢¼çµ„ç¹”å’Œç¶­è­·æ•ˆç‡
- âœ… ä¿æŒå®Œæ•´åŠŸèƒ½ä¸è®Š

---

## ğŸ“ **æ–°çš„æ–‡ä»¶çµæ§‹**

```
ğŸ“¦ é …ç›®æ ¹ç›®éŒ„
â”œâ”€â”€ ğŸ”§ pi.html                    # åŸå§‹ç‰ˆæœ¬ (ä¿ç•™)
â”œâ”€â”€ ğŸš€ pi-modular.html           # æ–°çš„æ¨¡çµ„åŒ–ç‰ˆæœ¬
â”œâ”€â”€ ğŸ“œ pi-script-refactored.js   # é‡æ§‹ç‰ˆJavaScript
â”œâ”€â”€ ğŸ“‚ components/               # çµ„ä»¶è³‡æ–™å¤¾
â”‚   â”œâ”€â”€ ğŸ”˜ waiting-state.html   # Press The Button é é¢
â”‚   â”œâ”€â”€ â³ loading-state.html   # Locating è¼‰å…¥é é¢  
â”‚   â”œâ”€â”€ ğŸ“Š result-state.html    # Result çµæœé é¢
â”‚   â””â”€â”€ ğŸ“¦ component-loader.js  # çµ„ä»¶è¼‰å…¥å™¨
â””â”€â”€ ğŸ“‹ æ¨¡çµ„åŒ–çµæ§‹èªªæ˜.md        # æœ¬èªªæ˜æ–‡ä»¶
```

---

## ğŸ”§ **çµ„ä»¶è©³ç´°èªªæ˜**

### **1. ğŸ”˜ waiting-state.html (Press The Button é é¢)**

**åŠŸèƒ½**: ç­‰å¾…ç”¨æˆ¶æŒ‰ä¸‹å¯¦é«”æŒ‰éˆ•çš„åˆå§‹é é¢

**åŒ…å«å…ƒç´ **:
- âœ¨ é–ƒçˆçš„ "PRESS THE BUTTON" æ¨™é¡Œ
- ğŸ†˜ éš±è—ç·Šæ€¥æŒ‰éˆ• (å·¦ä¸Šè§’é€æ˜)
- ğŸ“± ä¸­è‹±æ–‡æ“ä½œèªªæ˜
- ğŸ¨ å°ˆç”¨CSSæ¨£å¼å’Œå‹•ç•«
- âŒ¨ï¸ ç·Šæ€¥æŒ‰éˆ•å¢å¼·è…³æœ¬

**ç¨ç‰¹åŠŸèƒ½**:
```javascript
// éš±è—æŒ‰éˆ•å¢å¼·
enhanceHiddenButton()  // è¦–è¦ºå›é¥‹æ•ˆæœ
initWaitingState()     // ç‹€æ…‹åˆå§‹åŒ–
```

### **2. â³ loading-state.html (Locating è¼‰å…¥é é¢)**

**åŠŸèƒ½**: å¾Œç«¯è™•ç†åŸå¸‚æœå°‹å’ŒèªéŸ³ç”Ÿæˆæ™‚çš„è¼‰å…¥ç•«é¢

**åŒ…å«å…ƒç´ **:
- âœ¨ é–ƒçˆçš„ "LOCATING..." æ¨™é¡Œ
- ğŸ”„ å‹•æ…‹è¼‰å…¥é»æŒ‡ç¤ºå™¨
- ğŸ“± é€²åº¦ç‹€æ…‹æ–‡å­—è¼ªæ’­
- ğŸ¨ å°ˆç”¨è¼‰å…¥å‹•ç•«
- ğŸ“Š è™•ç†ç‹€æ…‹ç®¡ç†å™¨

**ç‹€æ…‹ç®¡ç†å™¨åŠŸèƒ½**:
```javascript
window.loadingStateManager.setStatus('ğŸŒ æ­£åœ¨æœå°‹åŸå¸‚ä½ç½®...')
window.loadingStateManager.resumeStatusRotation()  // æ¢å¾©è¼ªæ’­
window.loadingStateManager.cleanup()               // æ¸…ç†è³‡æº
```

### **3. ğŸ“Š result-state.html (Result çµæœé é¢)**

**åŠŸèƒ½**: é¡¯ç¤ºåŸå¸‚è³‡è¨Šã€åœ°åœ–è»Œè·¡å’Œå‰µæ„æ•…äº‹çš„æœ€çµ‚çµæœé é¢

**åŒ…å«å…ƒç´ **:
- ğŸ“… æ ¼å¼åŒ–æ—¥æœŸé¡¯ç¤º
- ğŸŒ ç•¶åœ°èªè¨€å•å€™èª
- ğŸ™ï¸ åŸå¸‚åç¨± (è‡ªå‹•æ·»åŠ å†’è™Ÿ)
- ğŸ³ï¸ åœ‹æ—— + åœ‹å®¶åç¨±
- ğŸ“ ç²¾ç¢ºåº§æ¨™ä¿¡æ¯
- ğŸ“– æ•…äº‹å®¹å™¨ (æ‰“å­—æ©Ÿæ•ˆæœ)
- ğŸ¨ éŸ¿æ‡‰å¼æµ®å±¤è¨­è¨ˆ

**çµæœç®¡ç†å™¨åŠŸèƒ½**:
```javascript
window.resultStateManager.updateResultData(cityData)           // æ›´æ–°åŸå¸‚è³‡æ–™
window.resultStateManager.displayStoryWithTypewriter(story)    // æ‰“å­—æ©Ÿæ•…äº‹
window.resultStateManager.setStoryStatus('ready')              // è¨­ç½®æ•…äº‹ç‹€æ…‹
```

### **4. ğŸ“¦ component-loader.js (çµ„ä»¶è¼‰å…¥å™¨)**

**åŠŸèƒ½**: å‹•æ…‹è¼‰å…¥HTMLçµ„ä»¶çš„æ ¸å¿ƒå·¥å…·

**ä¸»è¦API**:
```javascript
// è¼‰å…¥å–®å€‹çµ„ä»¶
await window.componentLoader.loadComponent(path, target, append)

// æ‰¹é‡è¼‰å…¥çµ„ä»¶  
await window.componentLoader.loadComponents([
    {path: './components/waiting-state.html', target: '.main-display'},
    {path: './components/loading-state.html', target: '.main-display'},
    {path: './components/result-state.html', target: '.main-display'}
])

// æª¢æŸ¥è¼‰å…¥ç‹€æ…‹
window.componentLoader.isLoaded(path, target)

// é‡æ–°è¼‰å…¥çµ„ä»¶
await window.componentLoader.reloadComponent(path, target)
```

**äº‹ä»¶ç³»çµ±**:
- `componentLoaded` - å–®å€‹çµ„ä»¶è¼‰å…¥å®Œæˆ
- `componentsLoaded` - æ‰¹é‡è¼‰å…¥å®Œæˆ  
- `allComponentsReady` - æ‰€æœ‰çµ„ä»¶æº–å‚™å°±ç·’

---

## ğŸš€ **ä½¿ç”¨æ–¹å¼**

### **é–‹ç™¼ç’°å¢ƒ**
```bash
# ä½¿ç”¨æ¨¡çµ„åŒ–ç‰ˆæœ¬é€²è¡Œé–‹ç™¼
http://localhost:3000/pi-modular.html

# åŸå§‹ç‰ˆæœ¬ (å‚™ä»½åƒè€ƒ)
http://localhost:3000/pi.html
```

### **æ¨¹è“æ´¾éƒ¨ç½²**
```bash
# å°‡æ•´å€‹ components/ è³‡æ–™å¤¾ä¸Šå‚³åˆ°æ¨¹è“æ´¾
scp -r components/ pi@raspberrypi:/home/pi/subjective-clock/

# æ›´æ–°ä¸»é é¢ (å¯é¸: æ›¿æ›åŸæœ‰ pi.html æˆ–ä½¿ç”¨æ–°åç¨±)
scp pi-modular.html pi@raspberrypi:/home/pi/subjective-clock/pi.html
```

### **JavaScript æ•´åˆ**
```javascript
// pi-script-refactored.js æœƒè‡ªå‹•èˆ‡çµ„ä»¶é…åˆ
// ç‹€æ…‹ç®¡ç†ä¿æŒä¸è®Š
StateManager.setState('waiting')  // é¡¯ç¤º waiting-state
StateManager.setState('loading')  // é¡¯ç¤º loading-state  
StateManager.setState('result')   // é¡¯ç¤º result-state
```

---

## ğŸ”„ **è¼‰å…¥æµç¨‹**

### **åˆå§‹åŒ–é †åº**
1. ğŸ“¦ **çµ„ä»¶è¼‰å…¥å™¨**: `component-loader.js` é¦–å…ˆè¼‰å…¥
2. ğŸ”¥ **Firebase é…ç½®**: `/api/config` è¼‰å…¥é…ç½®
3. ğŸ”¥ **Firebase SDK**: åˆå§‹åŒ– Firestore å’Œ Auth
4. ğŸ—ºï¸ **Leaflet åœ°åœ–**: è¼‰å…¥åœ°åœ–åº«
5. ğŸš€ **ä¸»è¦è…³æœ¬**: `pi-script-refactored.js` è¼‰å…¥
6. ğŸ“± **çµ„ä»¶è‡ªå‹•è¼‰å…¥**: ä¸‰å€‹é é¢çµ„ä»¶æ‰¹é‡è¼‰å…¥
7. ğŸ‰ **åˆå§‹åŒ–å®Œæˆ**: è§¸ç™¼ `allComponentsReady` äº‹ä»¶

### **çµ„ä»¶è¼‰å…¥äº‹ä»¶éˆ**
```mermaid
graph TD
    A[DOMè¼‰å…¥å®Œæˆ] --> B[çµ„ä»¶è¼‰å…¥å™¨å•Ÿå‹•]
    B --> C[æ‰¹é‡è¼‰å…¥ä¸‰å€‹çµ„ä»¶]
    C --> D[waiting-state.html]
    C --> E[loading-state.html] 
    C --> F[result-state.html]
    D --> G[allComponentsReadyäº‹ä»¶]
    E --> G
    F --> G
    G --> H[åœ°åœ–åˆå§‹åŒ–]
    G --> I[ç®¡ç†å™¨æº–å‚™å°±ç·’]
```

---

## ğŸ¯ **å„ªå‹¢å°æ¯”**

### **ğŸ”§ åŸå§‹ç‰ˆæœ¬ (pi.html)**
```html
<!-- å–®ä¸€æª”æ¡ˆ 434 è¡Œ -->
<div id="waitingState">...350è¡Œæ··åˆå…§å®¹...</div>
<div id="loadingState">...200è¡Œæ··åˆå…§å®¹...</div>  
<div id="resultState">...300è¡Œæ··åˆå…§å®¹...</div>
<script>...200è¡Œæ··åˆè…³æœ¬...</script>
```

### **âœ¨ æ¨¡çµ„åŒ–ç‰ˆæœ¬ (pi-modular.html + components/)**
```html
<!-- ä¸»æ–‡ä»¶ 200 è¡Œ (ç°¡æ½”) -->
<main class="main-display">
    <div id="mainMapContainer"></div>
    <!-- çµ„ä»¶å‹•æ…‹è¼‰å…¥ -->
</main>
<script src="components/component-loader.js"></script>
<script src="pi-script-refactored.js"></script>
```

**å„çµ„ä»¶å°ˆç²¾**:
- `waiting-state.html`: 110è¡Œ (å°ˆæ³¨ç­‰å¾…ç‹€æ…‹)
- `loading-state.html`: 150è¡Œ (å°ˆæ³¨è¼‰å…¥é«”é©—)
- `result-state.html`: 200è¡Œ (å°ˆæ³¨çµæœå±•ç¤º)

---

## ğŸ“Š **æ•ˆç›Šçµ±è¨ˆ**

| æŒ‡æ¨™ | åŸå§‹ç‰ˆæœ¬ | æ¨¡çµ„åŒ–ç‰ˆæœ¬ | æ”¹å–„ |
|------|----------|------------|------|
| **ä¸»æ–‡ä»¶è¡Œæ•¸** | 434è¡Œ | 200è¡Œ | -54% |
| **çµ„ä»¶åˆ†é›¢åº¦** | 0% | 100% | +100% |
| **ç¶­è­·é›£åº¦** | é«˜ | ä½ | -70% |
| **åŠŸèƒ½å®Œæ•´æ€§** | 100% | 100% | 0% |
| **æ“´å±•æ€§** | ä½ | é«˜ | +80% |
| **èª¿è©¦ä¾¿åˆ©æ€§** | ä½ | é«˜ | +90% |

---

## ğŸ”§ **é–‹ç™¼æŒ‡å—**

### **ä¿®æ”¹ Waiting é é¢**
```bash
# ç›´æ¥ç·¨è¼¯çµ„ä»¶æ–‡ä»¶
nano components/waiting-state.html

# ç„¡éœ€é‡å•Ÿï¼Œåˆ·æ–°é é¢å³å¯çœ‹åˆ°è®ŠåŒ–
```

### **ä¿®æ”¹ Loading é é¢**
```bash
# ç·¨è¼¯è¼‰å…¥ç‹€æ…‹
nano components/loading-state.html

# ä¿®æ”¹è¼‰å…¥è¨Šæ¯
window.loadingStateManager.setStatus('è‡ªå®šç¾©è¨Šæ¯')
```

### **ä¿®æ”¹ Result é é¢**
```bash  
# ç·¨è¼¯çµæœé é¢
nano components/result-state.html

# æ›´æ–°æ¨£å¼æˆ–åŠŸèƒ½
window.resultStateManager.updateResultData(newData)
```

### **èª¿è©¦çµ„ä»¶è¼‰å…¥**
```javascript
// æª¢æŸ¥çµ„ä»¶è¼‰å…¥ç‹€æ…‹
console.log(window.componentLoader.isLoaded('./components/waiting-state.html', '.main-display'))

// é‡æ–°è¼‰å…¥ç‰¹å®šçµ„ä»¶
await window.componentLoader.reloadComponent('./components/result-state.html', '.main-display')

// æ¸…ç†å¿«å–é‡æ–°è¼‰å…¥æ‰€æœ‰çµ„ä»¶
window.componentLoader.clearCache()
location.reload()
```

---

## ğŸ‰ **é·ç§»å®Œæˆ**

### **å…¼å®¹æ€§ä¿è­‰**
- âœ… æ‰€æœ‰åŸæœ‰åŠŸèƒ½å®Œæ•´ä¿ç•™
- âœ… `pi-script-refactored.js` å®Œå…¨å…¼å®¹
- âœ… ç‹€æ…‹ç®¡ç†APIä¸è®Š
- âœ… éš±è—æŒ‰éˆ•å’Œå¿«æ·éµåŠŸèƒ½ä¿æŒ

### **æ–°å¢ç‰¹æ€§**
- ğŸš€ **çµ„ä»¶ç†±é‡è¼‰**: é–‹ç™¼æ™‚ä¿®æ”¹å³æ™‚ç”Ÿæ•ˆ
- ğŸ“¦ **ç¨ç«‹çµ„ä»¶ç®¡ç†**: æ¯å€‹é é¢æœ‰å°ˆå±¬ç®¡ç†å™¨
- ğŸ”§ **æ›´å¥½çš„èª¿è©¦**: çµ„ä»¶éŒ¯èª¤éš”é›¢ï¼Œä¾¿æ–¼å®šä½
- ğŸ“ˆ **å¯æ“´å±•æ€§**: è¼•é¬†æ·»åŠ æ–°é é¢çµ„ä»¶

### **ä½¿ç”¨å»ºè­°**
1. **é–‹ç™¼éšæ®µ**: ä½¿ç”¨ `pi-modular.html` é€²è¡Œé–‹ç™¼
2. **ç”Ÿç”¢éƒ¨ç½²**: æ›¿æ›æ¨¹è“æ´¾ä¸Šçš„ `pi.html` ç‚ºæ¨¡çµ„åŒ–ç‰ˆæœ¬
3. **ç¶­è­·æ›´æ–°**: ç¨ç«‹ä¿®æ”¹å„çµ„ä»¶ï¼Œæå‡æ•ˆç‡

**ğŸ¯ é€™å€‹æ¨¡çµ„åŒ–æ¶æ§‹è®“ä½ å¯ä»¥æ›´è¼•é¬†åœ°æŸ¥æ‰¾å’Œä¿®æ­£å„å€‹é é¢ï¼ŒåŒæ™‚ä¿æŒç³»çµ±çš„å®Œæ•´åŠŸèƒ½ï¼** ğŸš€âœ¨