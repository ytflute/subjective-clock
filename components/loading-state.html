<!-- â³ Locating é é¢çµ„ä»¶ -->
<!-- è¼‰å…¥ç‹€æ…‹ - å¾Œç«¯è™•ç†åŸå¸‚æœå°‹å’ŒèªéŸ³ç”Ÿæˆæ™‚çš„è¼‰å…¥ç•«é¢ -->
<div id="loadingState" class="state loading-state">
    <!-- ä¸­å¤®å…§å®¹æ¡† -->
    <div class="loading-content-box">
        <h1 class="locating-title blinking-text">LOCATING...</h1>
        <p class="locating-progress">æ­£åœ¨ç‚ºä½ å®šä½ä»Šæ—¥çš„ç”¦é†’ä½ç½®......</p>
        <p class="locating-subtitle">è«‹ç¨å€™ï¼Œæ­£åœ¨è™•ç†ä¸­</p>
        
        <!-- è¼‰å…¥é€²åº¦æŒ‡ç¤ºå™¨ -->
        <div class="loading-indicator">
            <div class="loading-dots">
                <span class="dot dot1">â—</span>
                <span class="dot dot2">â—</span>
                <span class="dot dot3">â—</span>
            </div>
        </div>
        
        <!-- è™•ç†ç‹€æ…‹æ–‡å­— -->
        <div class="process-status">
            <p id="processStatusText" class="status-text">åˆå§‹åŒ–ä¸­...</p>
        </div>
    </div>
</div>

<!-- è¼‰å…¥ç‹€æ…‹å°ˆç”¨æ¨£å¼ -->
<style>
    /* è¼‰å…¥ç‹€æ…‹å®¹å™¨ */
    .loading-state {
        justify-content: center;
        align-items: center;
        background: linear-gradient(135deg, rgba(26, 35, 20, 0.95), rgba(45, 60, 35, 0.9));
    }
    
    /* è¼‰å…¥å…§å®¹æ¡† */
    .loading-content-box {
        text-align: center;
        padding: 50px 40px;
        border-radius: 15px;
        background: rgba(0, 0, 0, 0.8);
        border: 2px solid rgba(255, 193, 7, 0.4);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(10px);
        max-width: 650px;
        animation: pulseGlow 2s ease-in-out infinite alternate;
    }
    
    /* ä¸»æ¨™é¡Œ */
    .locating-title {
        font-family: 'Press Start 2P', 'ByteBounce', monospace;
        font-size: 28px;
        color: #ffc107;
        margin-bottom: 25px;
        text-shadow: 0 0 15px rgba(255, 193, 7, 0.6);
        letter-spacing: 3px;
    }
    
    /* é€²åº¦æ–‡å­— */
    .locating-progress {
        font-family: 'GB18030 Bitmap', 'Microsoft YaHei', sans-serif;
        font-size: 18px;
        color: #fff3c4;
        margin-bottom: 15px;
        opacity: 0.9;
    }
    
    /* å‰¯æ¨™é¡Œ */
    .locating-subtitle {
        font-family: 'Orbitron', monospace;
        font-size: 14px;
        color: #ffe082;
        margin-bottom: 30px;
        opacity: 0.8;
    }
    
    /* è¼‰å…¥æŒ‡ç¤ºå™¨ */
    .loading-indicator {
        margin: 20px 0;
    }
    
    .loading-dots {
        display: flex;
        justify-content: center;
        gap: 8px;
    }
    
    .dot {
        font-size: 20px;
        color: #ffc107;
        animation: dotPulse 1.5s ease-in-out infinite;
    }
    
    .dot1 { animation-delay: 0s; }
    .dot2 { animation-delay: 0.3s; }
    .dot3 { animation-delay: 0.6s; }
    
    @keyframes dotPulse {
        0%, 60%, 100% { 
            opacity: 0.3; 
            transform: scale(1);
        }
        30% { 
            opacity: 1; 
            transform: scale(1.2);
        }
    }
    
    /* è™•ç†ç‹€æ…‹å€åŸŸ */
    .process-status {
        margin-top: 20px;
        padding: 15px;
        background: rgba(255, 193, 7, 0.1);
        border-radius: 8px;
        border: 1px solid rgba(255, 193, 7, 0.2);
    }
    
    .status-text {
        font-family: 'GB18030 Bitmap', 'Microsoft YaHei', sans-serif;
        font-size: 14px;
        color: #fff8e1;
        margin: 0;
        opacity: 0.8;
        transition: opacity 0.3s ease;
    }
    
    /* è„ˆè¡ç™¼å…‰å‹•ç•« */
    @keyframes pulseGlow {
        0% { 
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.7), 0 0 20px rgba(255, 193, 7, 0.1); 
        }
        100% { 
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.7), 0 0 40px rgba(255, 193, 7, 0.3); 
        }
    }
    
    /* é–ƒçˆå‹•ç•« */
    .blinking-text {
        animation: blinkingAnimation 1.8s ease-in-out infinite;
    }
    
    @keyframes blinkingAnimation {
        0%, 50% { opacity: 1; }
        51%, 100% { opacity: 0.6; }
    }
</style>

<!-- è¼‰å…¥ç‹€æ…‹å°ˆç”¨è…³æœ¬ -->
<script>
    // è¼‰å…¥ç‹€æ…‹ç®¡ç†
    class LoadingStateManager {
        constructor() {
            this.statusMessages = [
                'ğŸŒ æ­£åœ¨æœå°‹åŸå¸‚ä½ç½®...',
                'ğŸ“– ç”Ÿæˆå‰µæ„æ•…äº‹ä¸­...',
                'ğŸµ æº–å‚™èªéŸ³å…§å®¹...',
                'ğŸ”¥ åŒæ­¥è³‡æ–™åˆ°é›²ç«¯...',
                'ğŸ—ºï¸ æ›´æ–°åœ°åœ–è»Œè·¡...',
                'âœ¨ æœ€å¾Œæ•´ç†ä¸­...'
            ];
            this.currentMessageIndex = 0;
            this.messageInterval = null;
        }
        
        init() {
            console.log('â³ è¼‰å…¥ç‹€æ…‹çµ„ä»¶å·²è¼‰å…¥');
            this.setupStatusUpdater();
        }
        
        // è¨­ç½®ç‹€æ…‹è¨Šæ¯è¼ªæ’­
        setupStatusUpdater() {
            const statusElement = document.getElementById('processStatusText');
            if (!statusElement) return;
            
            // ç«‹å³é¡¯ç¤ºç¬¬ä¸€å€‹è¨Šæ¯
            statusElement.textContent = this.statusMessages[0];
            
            // æ¯3ç§’åˆ‡æ›ä¸€æ¬¡è¨Šæ¯
            this.messageInterval = setInterval(() => {
                this.currentMessageIndex = (this.currentMessageIndex + 1) % this.statusMessages.length;
                statusElement.style.opacity = '0';
                
                setTimeout(() => {
                    statusElement.textContent = this.statusMessages[this.currentMessageIndex];
                    statusElement.style.opacity = '0.8';
                }, 150);
            }, 3000);
        }
        
        // è¨­ç½®è‡ªå®šç¾©ç‹€æ…‹è¨Šæ¯
        setStatus(message) {
            const statusElement = document.getElementById('processStatusText');
            if (statusElement) {
                statusElement.textContent = message;
                // æš«åœè¼ªæ’­
                if (this.messageInterval) {
                    clearInterval(this.messageInterval);
                    this.messageInterval = null;
                }
            }
        }
        
        // æ¢å¾©ç‹€æ…‹è¼ªæ’­
        resumeStatusRotation() {
            if (!this.messageInterval) {
                this.setupStatusUpdater();
            }
        }
        
        // æ¸…ç†è³‡æº
        cleanup() {
            if (this.messageInterval) {
                clearInterval(this.messageInterval);
                this.messageInterval = null;
            }
        }
    }
    
    // å…¨åŸŸè¼‰å…¥ç‹€æ…‹ç®¡ç†å™¨
    window.loadingStateManager = new LoadingStateManager();
    
    // çµ„ä»¶è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
        window.loadingStateManager.init();
    });
    
    // å¦‚æœå·²ç¶“è¼‰å…¥å®Œæˆï¼Œç«‹å³åˆå§‹åŒ–
    if (document.readyState === 'complete' || document.readyState === 'interactive') {
        window.loadingStateManager.init();
    }
    
    // ç›£è½è¼‰å…¥ç‹€æ…‹è®ŠåŒ–
    document.addEventListener('stateChanged', function(event) {
        if (event.detail && event.detail.state === 'loading') {
            console.log('ğŸ”„ é€²å…¥è¼‰å…¥ç‹€æ…‹');
            window.loadingStateManager.resumeStatusRotation();
        } else if (event.detail && event.detail.state !== 'loading') {
            console.log('ğŸ é›¢é–‹è¼‰å…¥ç‹€æ…‹');
            window.loadingStateManager.cleanup();
        }
    });
</script>