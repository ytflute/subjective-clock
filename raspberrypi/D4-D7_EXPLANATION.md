# D4-D7 資料線說明

## 什麼是D4-D7？

D4-D7 是 12864B-V2.3 LCD 的**資料線**（Data Lines），用來傳輸資料到LCD顯示器。

### 📊 **資料線位元分配**
```
D7 = 最高位元 (MSB - Most Significant Bit)
D6 = 第6位元
D5 = 第5位元  
D4 = 第4位元
D3 = 第3位元 (我們沒有連接)
D2 = 第2位元 (我們沒有連接)
D1 = 第1位元 (我們沒有連接)
D0 = 最低位元 (LSB，我們沒有連接)
```

## 🔄 **4位並行模式運作原理**

我們使用的是**4位並行模式**，只連接D4-D7，這樣可以節省GPIO針腳。

### **傳輸方式**
每個8位元的資料需要分**兩次**傳輸：

#### **第一次：傳輸高4位元**
```
原始資料：01000001 (ASCII 'A' = 65)
分解：     0100|0001
第一次：   0100 → D7,D6,D5,D4
```

#### **第二次：傳輸低4位元**  
```
第二次：   0001 → D7,D6,D5,D4
```

### **實際電信號**
```
D7 ──── GPIO 11 ──── 0 或 1
D6 ──── GPIO 5  ──── 0 或 1  
D5 ──── GPIO 6  ──── 0 或 1
D4 ──── GPIO 13 ──── 0 或 1
```

## 💻 **程式實作**

### **在我們的 lcd_driver.py 中**

```python
def write_8_bits(self, value):
    """實際上是4位模式，分兩次傳輸"""
    
    # 第一次：傳輸高4位元 (bits 7-4)
    GPIO.output(LCD_PINS['D7'], (value >> 7) & 0x01)  # 第7位
    GPIO.output(LCD_PINS['D6'], (value >> 6) & 0x01)  # 第6位
    GPIO.output(LCD_PINS['D5'], (value >> 5) & 0x01)  # 第5位
    GPIO.output(LCD_PINS['D4'], (value >> 4) & 0x01)  # 第4位
    
    # 發送 Enable 脈衝
    GPIO.output(LCD_PINS['E'], GPIO.HIGH)
    time.sleep(0.0005)
    GPIO.output(LCD_PINS['E'], GPIO.LOW)
    time.sleep(0.0005)
    
    # 第二次：傳輸低4位元 (bits 3-0)
    GPIO.output(LCD_PINS['D7'], (value >> 3) & 0x01)  # 第3位
    GPIO.output(LCD_PINS['D6'], (value >> 2) & 0x01)  # 第2位
    GPIO.output(LCD_PINS['D5'], (value >> 1) & 0x01)  # 第1位
    GPIO.output(LCD_PINS['D4'], (value >> 0) & 0x01)  # 第0位
    
    # 再次發送 Enable 脈衝
    GPIO.output(LCD_PINS['E'], GPIO.HIGH)
    time.sleep(0.0005)
    GPIO.output(LCD_PINS['E'], GPIO.LOW)
    time.sleep(0.0005)
```

## 🔍 **實際例子：顯示 "Hello"**

### **字符 'H' (ASCII 72)**
```
72 = 01001000 (二進制)

第一次傳輸 (高4位): 0100
D7=0, D6=1, D5=0, D4=0

第二次傳輸 (低4位): 1000  
D7=1, D6=0, D5=0, D4=0
```

### **字符 'e' (ASCII 101)**
```
101 = 01100101 (二進制)

第一次傳輸 (高4位): 0110
D7=0, D6=1, D5=1, D4=0

第二次傳輸 (低4位): 0101
D7=0, D6=1, D5=0, D4=1
```

## ⚡ **時序圖**

```
RS   ──────────────────── (HIGH = 資料模式)
E    ──┐     ┌──┐     ┌── (Enable 脈衝)
       └─────┘  └─────┘
D7   ────0────────1───── 
D6   ────1────────0─────
D5   ────0────────0─────  
D4   ────0────────0─────
     第一次傳輸  第二次傳輸
     (高4位)    (低4位)
```

## 🤔 **為什麼不用8位模式？**

### **8位模式需要：**
- D0, D1, D2, D3, D4, D5, D6, D7 (8根資料線)
- 總共需要 8 + 5 = 13 個GPIO針腳

### **4位模式只需要：**
- D4, D5, D6, D7 (4根資料線)  
- 總共需要 4 + 5 = 9 個GPIO針腳

**節省了4個GPIO針腳！**

## 🔧 **如果D4-D7接錯會怎樣？**

### **接線錯誤的後果：**
- **完全沒顯示** - 如果全部接錯
- **顯示亂碼** - 如果部分接錯
- **字符顛倒** - 如果D4和D7交換

### **正確檢查方式：**
```bash
# 測試D4-D7連接
python3 test_hardware.py lcd
```

## 🎯 **總結**

**D4-D7的作用：**
1. 🔌 **傳輸資料** - 將字符、指令傳送給LCD
2. 💾 **節省針腳** - 4位模式比8位模式省4個GPIO
3. ⚡ **控制顯示** - 每個字符都通過D4-D7傳輸
4. 🔄 **分次傳輸** - 8位資料分兩次4位傳輸

**記住：沒有D4-D7，LCD就無法接收任何資料來顯示！** 