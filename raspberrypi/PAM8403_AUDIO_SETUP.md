# PAM8403 數位功率放大模組設定指南

## 硬體規格

**PAM8403 數位功率放大模組特性：**
- 供電範圍：DC 5V
- 輸出功率：3W + 3W（雙聲道）
- 高保真音質數位晶片
- 內建電位器音量控制（帶開關）
- 470µF 電源濾波電容
- 1.6mm 玻纖板材

## 硬體連接

### 電源連接
```
PAM8403 模組    ->  Raspberry Pi
VCC/5V          ->  5V (Pin 2 或 Pin 4)
GND             ->  GND (Pin 6, 9, 14, 20, 25, 30, 34, 39)
```

### 音頻輸入連接
```
PAM8403 模組    ->  Raspberry Pi
Audio Input L   ->  3.5mm 音頻接口左聲道
Audio Input R   ->  3.5mm 音頻接口右聲道
GND             ->  3.5mm 音頻接口地線
```

**或使用 3.5mm 音頻線：**
- 將 3.5mm 音頻線一端插入 Raspberry Pi 的音頻輸出孔
- 另一端連接到 PAM8403 的音頻輸入端子

### 揚聲器連接
```
PAM8403 模組    ->  揚聲器
L+              ->  左聲道揚聲器正極
L-              ->  左聲道揚聲器負極
R+              ->  右聲道揚聲器正極
R-              ->  右聲道揚聲器負極
```

**推薦揚聲器規格：**
- 阻抗：4Ω - 8Ω
- 功率：3W 以上
- 尺寸：根據專案需求選擇

## 軟體配置

### 1. 確保音頻輸出到 3.5mm 接口
```bash
# 設定音頻輸出到類比接口（連接 PAM8403）
sudo amixer cset numid=3 1

# 或使用 raspi-config
sudo raspi-config
# 選擇 Advanced Options -> Audio -> Force 3.5mm
```

### 2. 測試音頻輸出
```bash
# 播放測試音效
speaker-test -c2 -t wav

# 測試 TTS 功能
python3 -c "
from audio_manager import AudioManager
audio = AudioManager()
audio.test_audio()
"
```

### 3. 調整音量
有兩種方式控制音量：

**硬體音量控制（推薦）：**
- 旋轉 PAM8403 上的電位器調節音量
- 逆時針旋轉到底可完全關閉電源

**軟體音量控制：**
```bash
# 使用 alsamixer 調整系統音量
alsamixer

# 或使用命令行
amixer sset PCM 80%
```

## 故障排除

### 沒有聲音輸出
1. **檢查電源連接**
   - 確認 PAM8403 的 LED 指示燈是否亮起
   - 檢查 5V 電源連接是否穩固

2. **檢查音頻連接**
   - 確認 3.5mm 音頻線連接正確
   - 測試音頻線是否正常

3. **檢查軟體設定**
   ```bash
   # 確認音頻輸出設定
   amixer cget numid=3
   # 應該顯示 values=1 (表示 3.5mm 輸出)
   
   # 檢查音量設定
   amixer sget PCM
   ```

### 音質不佳
1. **電源品質**
   - 使用穩定的 5V 電源供應器
   - 檢查電源線是否過長或過細

2. **音頻線品質**
   - 使用品質良好的音頻線
   - 避免音頻線與電源線平行走線

3. **揚聲器匹配**
   - 使用阻抗匹配的揚聲器（4-8Ω）
   - 確保揚聲器功率足夠

### 電位器控制異常
1. **清潔電位器**
   - 使用電子清潔劑清潔電位器觸點
   - 多次旋轉電位器清除氧化物

2. **檢查焊接**
   - 檢查電位器焊接點是否良好
   - 確認沒有虛焊或冷焊

## 最佳化設定

### 音頻品質優化
在 `config.py` 中的設定：
```python
AUDIO_CONFIG = {
    'sample_rate': 44100,    # 使用 CD 品質取樣率
    'channels': 2,           # 立體聲輸出
    'buffer_size': 512,      # 適中的緩衝區大小
}
```

### 語音合成優化
```python
TTS_CONFIG = {
    'quality': 'high',       # 高品質語音
    'slow': False,           # 正常語速
    'format': 'mp3',         # 適合的音頻格式
}
```

## 接線圖

```
Raspberry Pi                    PAM8403 模組
                               
Pin 2 (5V) -------------------- VCC
Pin 6 (GND) ------------------- GND
3.5mm Audio Jack -------------- Audio Input
                               
                               PAM8403 模組 -> 揚聲器
                               L+ ------------- 左聲道 +
                               L- ------------- 左聲道 -
                               R+ ------------- 右聲道 +
                               R- ------------- 右聲道 -
```

## 安全注意事項

1. **電源安全**
   - 確保電源電壓為 5V，勿超過
   - 注意電源極性，避免反接

2. **音量控制**
   - 初次使用時請將音量調到最小
   - 逐漸增加音量至適當位置

3. **散熱**
   - PAM8403 在大音量時會發熱
   - 確保適當的通風散熱

4. **靜電防護**
   - 操作時注意靜電防護
   - 建議戴防靜電手套

## 維護保養

1. **定期清潔**
   - 定期清潔模組表面灰塵
   - 保持散熱孔通暢

2. **連接檢查**
   - 定期檢查連接線是否鬆動
   - 確認焊接點無氧化

3. **存放環境**
   - 避免潮濕環境
   - 防止灰塵積累 